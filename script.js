const semesterCourses = {
    "1st Semester": [
        {
            id: 1,
            title: "Engineering Chemistry",
            description: "Fundamental concepts of chemistry for engineering applications",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-flask",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 2,
            title: "Engineering Mathematics–I",
            description: "Advanced mathematical concepts for engineering students",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-calculator",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 3,
            title: "Basic Electronics",
            description: "Introduction to electronic components and circuits",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-microchip",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 4,
            title: "C Programming",
            description: "Fundamentals of C programming language",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-code",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        }
    ],
    "2nd Semester": [
        {
            id: 5,
            title: "Engineering Physics",
            description: "Physics principles applied to engineering",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-atom",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 6,
            title: "Engineering Mathematics–II",
            description: "Advanced engineering mathematics topics",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-calculator",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 7,
            title: "Basic Electrical Engineering (BEE)",
            description: "Fundamentals of electrical engineering",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-bolt",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 8,
            title: "Web Programming (WP)",
            description: "Introduction to web development technologies",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-globe",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 9,
            title: "Python Programming",
            description: "Python programming fundamentals and applications",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fab fa-python",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        }
    ],
    "3rd Semester": [
        {
            id: 10,
            title: "Engineering Mathematics–III",
            description: "Advanced mathematical methods for engineering",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-calculator",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 11,
            title: "Java Programming",
            description: "Object-oriented programming with Java",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fab fa-java",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 12,
            title: "Computer Organization and Architecture (COA)",
            description: "Computer system organization and architecture",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-desktop",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 13,
            title: "Environmental Engineering and Chemistry (EEC)",
            description: "Environmental science and engineering principles",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-leaf",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 14,
            title: "Humanities and Value Education (HUV)",
            description: "Humanities and ethical values in engineering",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-users",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 15,
            title: "Data Structures (DS)",
            description: "Fundamental data structures and algorithms",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-sitemap",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        }
    ],
    "4th Semester": [
        {
            id: 16,
            title: "Advanced Computer Organization and Architecture",
            description: "Advanced computer architecture concepts",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-microchip",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 17,
            title: "Database Management Systems (DBMS)",
            description: "Database design and management systems",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-database",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 18,
            title: "Design and Analysis of Algorithms (DAA)",
            description: "Algorithm design and complexity analysis",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-project-diagram",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 19,
            title: "Data Communication and Computer Networks (DCCN)",
            description: "Computer networks and data communication",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-network-wired",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 20,
            title: "Organizational Behaviour (OB)",
            description: "Organizational behavior and management",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-building",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        }
    ],
    "5th Semester": [
        {
            id: 21,
            title: "Machine Learning (ML)",
            description: "Machine learning algorithms and applications",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-brain",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 22,
            title: "Formal Languages and Automata Theory (FLAT)",
            description: "Formal languages and automata theory",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-language",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 23,
            title: "Advanced Java Programming",
            description: "Advanced Java programming concepts",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fab fa-java",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 24,
            title: "Microprocessor and Microcontroller (MPMC)",
            description: "Microprocessor and microcontroller systems",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-microchip",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 25,
            title: "Internet and Web Technology (IWT)",
            description: "Advanced web technologies and internet protocols",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-wifi",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 26,
            title: "Operating Systems (OS)",
            description: "Operating system concepts and design",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-laptop-code",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        }
    ],
    "6th Semester": [
        {
            id: 27,
            title: "Software Engineering (SE)",
            description: "Software development methodologies and practices",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-cogs",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 28,
            title: "Internet of Things (IoT)",
            description: "IoT systems and applications",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-satellite-dish",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 29,
            title: "Deep Learning (DL)",
            description: "Deep learning algorithms and neural networks",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-network-wired",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 30,
            title: "Compiler Design (CD)",
            description: "Compiler design and construction",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-code",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 31,
            title: "Cloud Computing (CC)",
            description: "Cloud computing technologies and services",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-cloud",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 32,
            title: "Embedded Design (ED)",
            description: "Embedded system design and development",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-microchip",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 33,
            title: "Embedded Systems (ES)",
            description: "Embedded systems programming and applications",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-microchip",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        }
    ],
    "7th Semester": [
        {
            id: 34,
            title: "Computer Graphics (CG)",
            description: "Computer graphics algorithms and rendering",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-paint-brush",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 35,
            title: "Real Time Systems (RTS)",
            description: "Real-time system design and implementation",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-clock",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 36,
            title: "Computer and Network Security (CNS)",
            description: "Computer and network security principles",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-shield-alt",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 37,
            title: "Artificial Intelligence (AI)",
            description: "Artificial intelligence concepts and applications",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-robot",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        },
        {
            id: 38,
            title: "Data Analytics (DA)",
            description: "Data analysis techniques and tools",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-chart-bar",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        }
    ],
    "8th Semester": [
        {
            id: 39,
            title: "Project / Seminar Preparation",
            description: "Final year project and seminar preparation",
            playlistId: "",
            thumbnail: "",
            syllabus: "#",
            icon: "fas fa-graduation-cap",
            videos: 0,
            duration: "0h 00m",
            videoList: [
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" },
                { title: "", videoId: "", duration: "" }
            ]
        }
    ]
};

let currentPlaylist = null;
let currentVideoIndex = 0;
let currentCourseId = null;

const landingPage = document.getElementById('landingPage');
const mainApp = document.getElementById('mainApp');
const appHeader = document.querySelector('.app-header');
const exploreBtn = document.getElementById('exploreBtn');
const landingLoginBtn = document.getElementById('landingLoginBtn');
const userMenuBtn = document.getElementById('userMenuBtn');
const userDropdown = document.getElementById('userDropdown');
const mobileMenuBtn = document.getElementById('mobileMenuBtn');
const navMenu = document.querySelector('.nav-menu');
const coursesContainer = document.getElementById('coursesContainer');
const videoPlayerSection = document.getElementById('videoPlayerSection');
const youtubePlayer = document.getElementById('youtubePlayer');
const playlistItems = document.getElementById('playlistItems');
const currentPlaylistTitle = document.getElementById('currentPlaylistTitle');
const exploreCoursesBtn = document.getElementById('exploreCoursesBtn');
const dashboardHero = document.getElementById('dashboardHero');
const globalSearch = document.getElementById('globalSearch');
const notificationContainer = document.getElementById('notificationContainer');

function init() {
    handlePageAccess();
    loadEventListeners();
    renderNetflixStyleCourses();
    setupHeaderScroll();
    updateUserMenu();
    checkUrlAndShowCourses();
}

function handlePageAccess() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    
    if (currentUser) {
        showMainApp();
        showCoursesHomepage();
    } else {
        showLandingPage();
    }
}

function loadEventListeners() {
    exploreBtn.addEventListener('click', () => {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        
        if (!currentUser) {
            window.location.href = 'auth/login.html';
        } else {
            showMainApp();
            showCoursesHomepage();
        }
    });
    
    landingLoginBtn.addEventListener('click', () => {
        window.location.href = 'auth/login.html';
    });

    userMenuBtn.addEventListener('click', toggleUserDropdown);
    document.addEventListener('click', closeUserDropdown);

    mobileMenuBtn.addEventListener('click', toggleMobileMenu);
    
    if (exploreCoursesBtn) {
        exploreCoursesBtn.addEventListener('click', function(e) {
            e.preventDefault();
            showCoursesHomepage();
        });
    }
    
    const navLinks = document.querySelectorAll('.nav-link[data-section]');
    navLinks.forEach(link => {
        link.addEventListener('click', handleNavigation);
    });
    
    if (globalSearch) {
        globalSearch.addEventListener('input', handleGlobalSearch);
    }
    
    setupProtectedNavigation();
    
    document.addEventListener('click', function(e) {
        if (e.target.closest('.logo') && !e.target.closest('.landing-header')) {
            e.preventDefault();
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser) {
                showCoursesHomepage();
            } else {
                window.location.href = 'index.html';
            }
        }
    });
    
    window.addEventListener('load', checkUrlAndShowCourses);
}

function handleNavigation(e) {
    e.preventDefault();
    
    if (!checkAuthentication()) return;
    
    const section = e.currentTarget.getAttribute('data-section');
    
    if (section === 'courses') {
        showCoursesHomepage();
        return;
    }
    
    navLinks.forEach(link => link.classList.remove('active'));
    e.currentTarget.classList.add('active');
    
    contentSections.forEach(sec => sec.classList.remove('active'));
    document.getElementById(`${section}Section`).classList.add('active');
    
    navMenu.classList.remove('active');
}

function checkUrlAndShowCourses() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    const isIndexPage = window.location.pathname.endsWith('index.html') || 
                       window.location.pathname.endsWith('/') ||
                       window.location.pathname.includes('index.html');
    
    if (currentUser && isIndexPage) {
        showCoursesHomepage();
    }
}

function setupProtectedNavigation() {
    const protectedLinks = document.querySelectorAll('a[href*="dashboard"], a[href*="profile"], a[href*="admin"]');
    
    protectedLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            if (!currentUser) {
                e.preventDefault();
                showNotification('Please login to access this page', 'error');
                setTimeout(() => {
                    window.location.href = 'auth/login.html';
                }, 1500);
                return;
            }
            
            if (this.href.includes('admin') && currentUser.role !== 'admin') {
                e.preventDefault();
                showNotification('Admin access required', 'error');
                return;
            }
        });
    });
}

function setupHeaderScroll() {
    window.addEventListener('scroll', () => {
        if (window.scrollY > 100) {
            appHeader.classList.add('scrolled');
        } else {
            appHeader.classList.remove('scrolled');
        }
    });
}

function showMainApp() {
    landingPage.classList.remove('active');
    mainApp.classList.add('active');
    updateUIForUser();
}

function showLandingPage() {
    landingPage.classList.add('active');
    mainApp.classList.remove('active');
}

function showCoursesHomepage() {
    console.log('showCoursesHomepage called');
    
    if (dashboardHero) {
        dashboardHero.style.display = 'none';
    }
    
    resetToCoursesView();
    
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => link.classList.remove('active'));
    
    const coursesNavLinks = document.querySelectorAll('.nav-link[data-section="courses"]');
    coursesNavLinks.forEach(link => link.classList.add('active'));
    
    const contentSections = document.querySelectorAll('.content-section');
    contentSections.forEach(sec => {
        sec.classList.remove('active');
        sec.style.display = 'none';
        
        if (sec.id === 'coursesSection') {
            sec.classList.add('active');
            sec.style.display = 'block';
        }
    });
    
    if (coursesContainer) {
        coursesContainer.style.display = 'block';
    }
    if (videoPlayerSection) {
        videoPlayerSection.style.display = 'none';
    }
    
    renderNetflixStyleCourses();
    
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    console.log('Courses homepage shown - Netflix style');
}

function resetToCoursesView() {
    console.log('resetToCoursesView called');
    
    if (coursesContainer) {
        coursesContainer.style.display = 'block';
    }
    if (videoPlayerSection) {
        videoPlayerSection.style.display = 'none';
    }
    
    if (youtubePlayer) {
        youtubePlayer.src = '';
    }
    
    currentPlaylist = null;
    currentVideoIndex = 0;
    currentCourseId = null;
    
    renderNetflixStyleCourses();
}

function updateUIForUser() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    const userWelcome = document.getElementById('userWelcome');
    
    if (currentUser && userWelcome) {
        userWelcome.textContent = currentUser.name;
        updateUserMenu();
    }
}

function toggleUserDropdown() {
    userDropdown.classList.toggle('show');
}

function closeUserDropdown(e) {
    if (!e.target.closest('.user-menu')) {
        userDropdown.classList.remove('show');
    }
}

function toggleMobileMenu() {
    navMenu.classList.toggle('active');
}

function handleGlobalSearch() {
    const term = globalSearch.value.toLowerCase();
    
    if (term.length > 2) {
        filterCourses(term);
    } else {
        renderNetflixStyleCourses();
    }
}

function filterCourses(term) {
    let filteredCourses = {};
    
    for (const [category, courses] of Object.entries(semesterCourses)) {
        const filtered = courses.filter(course => 
            course.title.toLowerCase().includes(term) || 
            course.description.toLowerCase().includes(term)
        );
        
        if (filtered.length > 0) {
            filteredCourses[category] = filtered;
        }
    }
    
    renderFilteredCourses(filteredCourses);
}

function renderFilteredCourses(filteredCourses) {
    if (!coursesContainer) return;
    
    let html = '';
    
    for (const [category, courses] of Object.entries(filteredCourses)) {
        html += `
            <div class="netflix-row">
                <div class="row-header">
                    <h2 class="row-title">${category}</h2>
                </div>
                <div class="row-container">
                    <div class="row-content">
                        ${courses.map(course => `
                            <div class="netflix-item" data-course-id="${course.id}" data-playlist-id="${course.playlistId}">
                                <div class="item-image">
                                    <div class="course-icon-placeholder">
                                        <i class="${course.icon}"></i>
                                    </div>
                                    <div class="item-overlay">
                                        <div class="play-button">
                                            <i class="fas fa-play"></i>
                                        </div>
                                        <div class="item-info">
                                            <h3>${course.title}</h3>
                                            <p>${course.description}</p>
                                            <div class="item-meta">
                                                <span><i class="fas fa-play-circle"></i> ${course.videos} videos</span>
                                                <span><i class="fas fa-clock"></i> ${course.duration}</span>
                                            </div>
                                            <div class="item-actions">
                                                <button class="btn-watch" onclick="event.stopPropagation(); openVideoPlayer('${course.playlistId}', '${course.title}', ${course.id})">
                                                    <i class="fas fa-play"></i> Watch Now
                                                </button>
                                                <a href="${course.syllabus}" target="_blank" class="btn-syllabus" onclick="event.stopPropagation(); showComingSoon(event)">
                                                    <i class="fas fa-file-pdf"></i> Syllabus
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="item-title">${course.title}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
    }
    
    if (html === '') {
        html = `
            <div class="no-results">
                <i class="fas fa-search"></i>
                <h3>No courses found</h3>
                <p>Try different search terms</p>
            </div>
        `;
    }
    
    coursesContainer.innerHTML = html;
}

function updateUserMenu() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    
    if (currentUser) {
        userDropdown.innerHTML = `
            <a href="profile/profile.html"><i class="fas fa-user-circle"></i> Profile</a>
            <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Sign Out</a>
        `;
        
        document.getElementById('logoutBtn').addEventListener('click', handleLogout);
    } else {
        userDropdown.innerHTML = `
            <a href="auth/login.html"><i class="fas fa-sign-in-alt"></i> Sign In</a>
            <a href="auth/signup.html"><i class="fas fa-user-plus"></i> Sign Up</a>
        `;
    }
}

function handleLogout(e) {
    e.preventDefault();
    localStorage.removeItem('currentUser');
    window.location.href = 'index.html';
}

function renderNetflixStyleCourses() {
    if (!coursesContainer) return;
    
    let html = '';
    
    for (const [category, courses] of Object.entries(semesterCourses)) {
        html += `
            <div class="netflix-row">
                <div class="row-header">
                    <h2 class="row-title">${category}</h2>
                </div>
                <div class="row-container">
                    <button class="row-arrow row-arrow-left" onclick="scrollRow(this, -1)">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="row-content">
                        ${courses.map(course => `
                            <div class="netflix-item" data-course-id="${course.id}" data-playlist-id="${course.playlistId}">
                                <div class="item-image">
                                    <div class="course-icon-placeholder">
                                        <i class="${course.icon}"></i>
                                    </div>
                                    <div class="item-overlay">
                                        <div class="play-button">
                                            <i class="fas fa-play"></i>
                                        </div>
                                        <div class="item-info">
                                            <h3>${course.title}</h3>
                                            <p>${course.description}</p>
                                            <div class="item-meta">
                                                <span><i class="fas fa-play-circle"></i> ${course.videos} videos</span>
                                                <span><i class="fas fa-clock"></i> ${course.duration}</span>
                                            </div>
                                            <div class="item-actions">
                                                <button class="btn-watch" onclick="event.stopPropagation(); openVideoPlayer('${course.playlistId}', '${course.title}', ${course.id})">
                                                    <i class="fas fa-play"></i> Watch Now
                                                </button>
                                                <a href="${course.syllabus}" target="_blank" class="btn-syllabus" onclick="event.stopPropagation(); showComingSoon(event)">
                                                    <i class="fas fa-file-pdf"></i> Syllabus
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="item-title">${course.title}</div>
                            </div>
                        `).join('')}
                    </div>
                    <button class="row-arrow row-arrow-right" onclick="scrollRow(this, 1)">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        `;
    }
    
    coursesContainer.innerHTML = html;
    
    document.querySelectorAll('.netflix-item').forEach(item => {
        item.addEventListener('click', function(e) {
            if (e.target.closest('.btn-watch') || e.target.closest('.btn-syllabus')) {
                return;
            }
            
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            if (!currentUser) {
                window.location.href = 'auth/login.html';
                return;
            }
            
            const playlistId = this.getAttribute('data-playlist-id');
            const courseTitle = this.querySelector('.item-title').textContent;
            const courseId = parseInt(this.getAttribute('data-course-id'));
            openVideoPlayer(playlistId, courseTitle, courseId);
        });
    });
}

function scrollRow(arrow, direction) {
    const rowContainer = arrow.closest('.row-container');
    const rowContent = rowContainer.querySelector('.row-content');
    const scrollAmount = 300;
    
    rowContent.scrollBy({
        left: direction * scrollAmount,
        behavior: 'smooth'
    });
}

function openVideoPlayer(playlistId, courseTitle, courseId) {
    if (coursesContainer) {
        coursesContainer.style.display = 'none';
    }
    if (videoPlayerSection) {
        videoPlayerSection.style.display = 'block';
    }
    
    if (currentPlaylistTitle) {
        currentPlaylistTitle.textContent = courseTitle;
    }
    
    currentCourseId = courseId;
    
    // Find the course to get its video list
    let courseVideos = [];
    for (const semester in semesterCourses) {
        const course = semesterCourses[semester].find(c => c.id === courseId);
        if (course && course.videoList) {
            courseVideos = course.videoList;
            break;
        }
    }
    
    currentPlaylist = courseVideos.length > 0 ? courseVideos : [{ title: "Content Coming Soon", videoId: "", duration: "00:00" }];
    currentVideoIndex = 0;
    
    renderPlaylistItems();
    if (currentPlaylist[0].videoId) {
        loadVideo(currentPlaylist[0].videoId);
    }
}

function renderPlaylistItems() {
    if (!playlistItems) return;
    
    playlistItems.innerHTML = currentPlaylist.map((video, index) => `
        <li class="playlist-item ${index === currentVideoIndex ? 'active' : ''}" data-video-index="${index}">
            <div class="video-title">${index + 1}. ${video.title}</div>
            <div class="video-duration">${video.duration}</div>
        </li>
    `).join('');
    
    document.querySelectorAll('.playlist-item').forEach(item => {
        item.addEventListener('click', function() {
            const index = parseInt(this.getAttribute('data-video-index'));
            playVideo(index);
        });
    });
}

function playVideo(index) {
    currentVideoIndex = index;
    const video = currentPlaylist[index];
    loadVideo(video.videoId);
    renderPlaylistItems();
}

function loadVideo(videoId) {
    if (youtubePlayer && videoId) {
        youtubePlayer.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
    } else if (youtubePlayer) {
        youtubePlayer.src = "";
        youtubePlayer.innerHTML = `
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #000; color: white; font-size: 1.2rem;">
                <div style="text-align: center;">
                    <i class="fas fa-video-slash" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                    <p>Video content coming soon</p>
                </div>
            </div>
        `;
    }
}

function showComingSoon(event) {
    event.preventDefault();
    showNotification('Syllabus coming soon!', 'info');
}

function checkAuthentication() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    
    if (!currentUser) {
        window.location.href = 'auth/login.html';
        return false;
    }
    
    return true;
}

function showNotification(message, type) {
    if (!notificationContainer) return;
    
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <span>${message}</span>
        <button onclick="this.parentElement.remove()">&times;</button>
    `;
    
    notificationContainer.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 5000);
}

window.navigateToCourses = showCoursesHomepage;
window.showCoursesHomepage = showCoursesHomepage;
window.resetToCoursesView = resetToCoursesView;
window.scrollRow = scrollRow;
window.openVideoPlayer = openVideoPlayer;
window.showComingSoon = showComingSoon;

document.addEventListener('DOMContentLoaded', function() {
    init();
    
    setTimeout(() => {
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        const isOnMainPage = window.location.pathname.endsWith('index.html') || 
                            window.location.pathname.endsWith('/');
        
        if (currentUser && isOnMainPage) {
            showCoursesHomepage();
        }
    }, 100);
});